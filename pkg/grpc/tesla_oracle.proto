syntax = "proto3";

option go_package = "github.com/DIMO-Network/tesla-oracle/pkg/grpc";

package tesla_oracle;

import "google/protobuf/timestamp.proto";

/*
  TeslaOracle replaces devices-api for Tesla synthetic device calls.
*/
service TeslaOracle {
  rpc RegisterNewSyntheticDevice(RegisterNewSyntheticDeviceRequest) returns (RegisterNewSyntheticDeviceResponse);
  rpc RegisterNewSyntheticDeviceV2(RegisterNewSyntheticDeviceV2Request) returns (RegisterNewSyntheticDeviceV2Response);
  rpc GetSyntheticDevicesByVIN(GetSyntheticDevicesByVINRequest) returns (GetSyntheticDevicesByVINResponse);
}

message RegisterNewSyntheticDeviceRequest {
  string vin = 1;
  bytes synthetic_device_address = 2;
  uint64 wallet_child_num = 3;
}

message RegisterNewSyntheticDeviceResponse {
}

message RegisterNewSyntheticDeviceV2Request {
  string vin = 1;
  string encrypted_access_token = 2;
  string encrypted_refresh_token = 3;
  google.protobuf.Timestamp access_token_expiry = 4;
  google.protobuf.Timestamp refresh_token_expiry = 5;
}

message RegisterNewSyntheticDeviceV2Response {
  bytes synthetic_device_address = 1;
  uint32 wallet_child_num = 2;
}


message GetSyntheticDevicesByVINRequest {
  string vin = 1;
}

message GetSyntheticDevicesByVINResponse {
  repeated SyntheticDevice synthetic_devices = 1;
}

message SyntheticDevice {
  string vin = 1;
  bytes address = 2;
  uint64 wallet_child_num = 3;
  uint64 token_id = 4;
  uint64 vehicle_token_id = 5;
  string subscription_status = 6;
}

